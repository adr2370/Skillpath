<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
    .arrows {
    	position: relative;
    	height:60px;
    }
.arrowUp {
	background:url('img/arrow-up.png') no-repeat;
	width: 61px;
	padding-top:38px;
	text-align: center
}
.arrowDown {
	background:url('img/arrow-down2.png') no-repeat;
	width: 61px;
	height: 72px;
	text-align: center;
}
.arrowDown:hover {
	background:url('img/arrow-down-active2.png') no-repeat;
}
.arrowUp:hover {
	background:url('img/arrow-up-active.png') no-repeat;
}
.linkListing {
	margin-bottom: 40px;
}
.linkText {
	margin-left: 70px;
	margin-top: -36px;
}
.linkText h2 {
	margin: 0;
}
    </style>
</head>
<body>
<h1></h1>





<div id="nodeContainer"></div>
<div id="urlContainer"></div>
<div style="position: fixed; right: 0px; top: 0px; height: 100%; width: 250px; background-color: grey;">
	<div style="float: left; margin-left: 10px; margin-top: 10px;">
		<img id="photo" src="">
	</div>
	<div id="name" style="float: left; margin-left: 10px; margin-top: 26px; font-size: 18px;"></div>
	<div style="float: left; margin-left: 10px; margin-top: 10px; clear: both;">
		<input placeholder="Search..." style=" width: 222px;">
	</div>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src='//cdn.firebase.com/v0/firebase.js'></script>
<script src='//cdn.firebase.com/v0/firebase-auth-client.js'></script>
<script src='js/underscore-min.js'></script>
<script src='js/fireFunctions.js'></script>
<script>
var userid = getCookie('cookie');
var nodeId = getUrlVars()['id'];

// Updates H1 & grabs node links
fb.child("node").child(nodeId).on("value", function(nodeInfo) {
	var nodeName = nodeInfo.val().name;
	var nodeLinks = nodeInfo.val().links;
	var sortedLinks = _.chain(nodeLinks)
		.sortBy(function(link){ return link.down-link.up; })
		.map(function(link){ return { "url": link.url, "up": link.up, "down": link.down } } )
		.value();
	var links = [];

	$('h1').text(nodeName);
	// console.log(sortedLinks);
	$.each( sortedLinks, function(key,value) {
		url = window.atob(value.url); // Reverses base64
		links.push(
			'<div class="linkListing">'+
				'<div class="arrows">'+
					'<div class="arrowUp upVote" data-nodelink="'+value.url+'">'+
						'<span class="upCount" data-nodelink="'+value.url+'">'+value.up+'</span>'+
					'</div>'+
					'<div class="arrowDown downVote" data-nodelink="'+value.url+'">'+
						'<span class="downCount" data-nodelink="'+value.url+'">'+value.down+'</span>'+
					'</div>	'+
				'</div>'+
				'<a href="'+url+'">'+
				'<div class="linkText">'+
					'<h2>'+url+'</h2>'+
					'<em>'+url+'</em>'+
				'</div>'+
				'</a>'+
			'</div>'
		);
	});
	$('#urlContainer').html(links.join(''));
});

// Pushes upvotes to firebase
$('#urlContainer').on('click', '.upVote', function() {
	var nodeLink = $(this).data('nodelink');
	addUpVote(nodeId,nodeLink,userid);
});

// Pushes downvotes to firebase
$('#urlContainer').on('click', '.downVote', function() {
	var nodeLink = $(this).data('nodelink');
	addDownVote(nodeId,nodeLink,userid);
});

function getCookie(c_name) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) c_end = document.cookie.length;
            return unescape(document.cookie.substring(c_start, c_end));
        }
    }
    return "";
}

// Gets node id from URL
function getUrlVars()
{
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}

</script>	
</body>
</html>